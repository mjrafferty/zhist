# vim:ft=zsh

__zhist_watcher_start () {

  if [[ ! -p "${__ZHIST_WATCH_FILE}" ]]; then
    rm "$__ZHIST_WATCH_FILE" &> /dev/null
    mkfifo "${__ZHIST_WATCH_FILE}"
    chmod 600 "${__ZHIST_WATCH_FILE}";
  fi

  __zhist_watcher_stop;

  __zhist_watcher &!

  __ZHIST_WATCHER_PID="$!"

  echo "${__ZHIST_WATCHER_PID}" >| "${__ZHIST_PID_FILE}"
  chmod 600 "$__ZHIST_PID_FILE";

}

__zhist_watcher_start "$@"
